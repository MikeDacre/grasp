#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
A Simple GRASP (grasp.nhlbi.nih.gov) API based on SQLAlchemy and Pandas

===============================================================================

        AUTHOR: Michael D Dacre, mike.dacre@gmail.com
  ORGANIZATION: Stanford University
       LICENSE: MIT License, property of Stanford, use as you wish
       CREATED: 2016-11-08
 Last modified: 2016-10-10 12:13

   DESCRIPTION: This is the front-end to a python grasp api, intended to allow
                easy database creation and simple querying.
                For most of the functions of this module, you will need to
                call the module directly.

===============================================================================
"""
import os
import sys
import argparse

from grasp import db

###############################################################################
#                            Command Line Running                             #
###############################################################################


def main(argv=None):
    """Parse command line options to run as a script."""
    if not argv:
        argv = sys.argv[1:]

    parser  = argparse.ArgumentParser(
        description=__doc__,
        formatter_class=argparse.RawDescriptionHelpFormatter)

    subparsers = parser.add_subparsers(dest='modes')

    # Initialize the database
    init = subparsers.add_parser('init', help="Initialize the database")
    init.add_argument('db_file',
                      help="File to write the database to")
    init.add_argument('grasp_file', nargs='?',
                      help="GRASP tab delimeted file")
    init.add_argument('-p', '--progress', action='store_true',
                      help="Display a progress bar")

    args = parser.parse_args(argv)

    if args.modes == 'init':
        sys.stderr.write("Initializing\n")
        if os.path.exists(args.db_file):
            os.remove(args.db_file)
        grasp_file = args.grasp_file if args.grasp_file else sys.stdin
        db.initialize_database(grasp_file, dbfile=args.db_file,
                            progress=args.progress)
    else:
        parser.print_help()

if __name__ == '__main__' and '__file__' in globals():
    sys.exit(main())
